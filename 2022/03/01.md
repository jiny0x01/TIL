# TIL

## 오늘 공부한 컨셉

## 상세내용

### Go Context
context 패키지는 context 타입이 정의된 패지지다. 컨텍스트는 데드라인, 취소 신호 및 기타 요청 범위 값을 API 경계를 넘어 프로세스간에 전달한다.

서ㅇ에 대한 수신 요청은 컨텍스트를 생성해야하며 서버로부터 나가는 호출은 컨텍스트를 수락해야한다.
이들 간의 함수 호출은 컨텍스트를 전달해야 하며 선택적으로 WithCancel, WithDeadline, WithTimeout 또는 WithValue를 사용하여 작성된 파생 컨텍스트로 대체한다. 컨텍스트가 취소되면 컨텍스트에서 파생된 모든 컨텍스트도 취소된다.

WithCancel, WithDeadline 및 WithTimeout 함수는 컨텍스트(상위)를 사용하고 파생 컨텍스트(하위)와 CancelFunc를 반환합니다. CancelFunc를 호출하면 하위 및 하위 항목이 취소되고 하위 항목에 대한 상위 항목의 참조가 제거되며 연결된 타이머가 중지됩니다. CancelFunc를 호출하지 못하면 상위 항목이 취소되거나 타이머가 실행될 때까지 하위 항목과 하위 항목이 누수됩니다. Go vet 도구에서는 CancelFuncs가 모든 제어 흐름 경로에 사용되는지 확인합니다.

컨텍스트를 사용하는 프로그램은 패키지 간에 인터페이스를 일관되게 유지하고 정적 분석 도구를 사용하여 컨텍스트 전파를 검사하려면 다음 규칙을 따라야 합니다.

### 컨텍스트 작성 규칙
**구조체 유형 내에 컨텍스트를 저장하지 말고, 컨텍스트를 필요로 하는 각 함수에 컨텍스트를 명시적으로 전달합니다. 컨텍스트는 일반적으로 ctx로 명명된 첫 번째 파라미터여야 합니다.**

### https://go.dev/blog/context
Go 서버에서는 각각의 요청은 고루틴이 할당되어 처리된다.
Request handler는 종종 데이터베이스 및 RPC 서비스와 같은 백엔드에 엑세스하기 위해 추가 goroutine을 시작한다.
요청이 취소되거나 시간이 만료되면 모든 고루틴은 시스템 자원을 재사용하기 위해 신속하게 종료되어야한다.
context 패키지는 요청범위값, 취소, 시그널, 데드라인을 API 경계를 넘어 요청된 고루틴에 쉽게 전달하기 위해 개발 되었다.

### derived context (파생된 context)
Context는 취소되면 모든 파생된 Context들도 취소된다.
```func Background() Context``` 는 Context 트리를 구성하는 최상위 루트 Context이며 절대로 취소되지 않는다.

### 결론
구글은 Go 프로그래머가 Context를 요청이 오고 가는 함수의 첫번째 파라미터로 넘겨줄 것을 요구한다.
이 방법은 서로 다른 Go 코드를 작성하는 팀들에게 상호작용하게 해준다. Context는 쉽게 타임아웃과 취소, Go 프로그램이 보안취약점 없이 잘 굴러가도록 제공해준다.

Context를 기반으로 작성하려는 서버 프레임워크는 해당 패키지와 Context 매개 변수가 필요한 패키지 간의 브리지를 위한 Context 구현을 제공해야 합니다. 그런 다음 클라이언트 라이브러리는 호출 코드로부터 컨텍스트를 수락합니다. Context는 요청 범위 데이터와 취소를 위한 공통 인터페이스를 구축함으로써 패키지 개발자들이 확장 가능한 서비스를 만들기 위한 코드를 더 쉽게 공유할 수 있도록 한다.

Gin이랑 Fiber를 둘 다 살짝 해봤는데 두 서버프레임워크 모두 첫번째 파라미터로 Context를 넘겨준다.

## Referece
+ https://pkg.go.dev/context
+ https://go.dev/blog/context